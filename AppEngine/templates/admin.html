{% extends "base_generic.html" %}
{% block title %}<title>Trawl Search: A simple app for mining Common Crawl data by Akshay Bhat</title>{% endblock %}
{% block script %}
        <script>
        var current_results = [];
        function change_server()
        {
            $('#status').html('<div class="span12 alert alert-warning" id="status" style="text-align:center"><span class="close" data-dismiss="alert">×</span><b id="status_text">Change server (requires administrator privileges).</b><form action="/Admin/" method="POST" ><input type="text" name="server" placeholder="please enter EC2 server. E.g. ec2-**-***-***-***.compute-1.amazonaws.com" id="server_input" class="span7" style="margin-top: 8px;"><button style="display:inline-block;margin-left: 5px;" class="btn" id="search_btn">Set server</button></form></div>');
            return false
        }

        function server_error()
        {
            $('#status').html('<div class="span12 alert alert-error" id="status" style="text-align:center"><b id="status_text">Could not connect to the server.</b><form action="/Admin/" method="POST" ><input type="text" name="server" placeholder="please enter EC2 server. E.g. ec2-**-***-***-***.compute-1.amazonaws.com" id="server_input" class="span7" style="margin-top: 8px;"><button style="display:inline-block;margin-left: 5px;" class="btn" id="search_btn">Set server</button></form></div>');
        }
        function server_okay()
        {
                $('#status').html('<div class="span12 alert alert-success" id="status" style="text-align:center"><b id="status_text">Connected to the server.</b> <span class="close" data-dismiss="alert">×</span></div>')
        }
        function submit(){
                $.ajax({
                  dataType: "json",
                  url: '/Search/',
                  data: {'q':$('#query').val()},
                  success: function(response,status){current_results.push(response);}
                   });
            return false;
        };

        function test_server(){
                $.ajax({
                  url: '/Server/',
                  success: function(response){
                      console.log(response)
                      if (response.status == 'live')
                      {
                          server_okay();
                      }
                      else
                      {
                          server_error();
                      }
                  },
                  error: server_error
                  })
                ;
        };

            $(
            function(){
                $('#search_btn').click(submit);
                $('#change_server').click(change_server);
                test_server();
                setTimeout(test_server, 5*60000);
            });
        </script>
{% endblock %}
{% block content %}
    <div class="row halfmargin" id="status">
    </div>
    <div class="row">

    </div>
<div class="row halfmargin">
            <div class="span8 offset2">

            </div>
    </div>
<div class="row" id="result_row">


</div>
{% endblock %}

